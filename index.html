<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>工作計數器 App</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 引入 Babel (用於解析 JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 設定 PWA 相關 Meta (讓手機加入主畫面時更像 App) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#f8fafc">

    <style>
        /* 禁用雙擊縮放與選取，讓體驗更像 App */
        body {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
            overscroll-behavior-y: none; /* 防止下拉重整 */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 圖示組件 (SVG) ---
        // 為了單一檔案運行，我們手動定義這些圖示
        const Icon = ({ children, size = 24, className = "", ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
                {...props}
            >
                {children}
            </svg>
        );

        const Plus = (props) => <Icon {...props}><path d="M5 12h14M12 5v14"/></Icon>;
        const RotateCcw = (props) => <Icon {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/></Icon>;
        const Trash2 = (props) => <Icon {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></Icon>;
        const History = (props) => <Icon {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/><path d="M12 7v5l3 3"/></Icon>;
        const AlertTriangle = (props) => <Icon {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></Icon>;
        const Settings = (props) => <Icon {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></Icon>;
        const X = (props) => <Icon {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></Icon>;
        const DollarSign = (props) => <Icon {...props}><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></Icon>;


        // --- 主程式邏輯 ---
        function App() {
            // 初始化狀態：嘗試從 localStorage 讀取數據
            const [count, setCount] = useState(() => {
                const savedCount = localStorage.getItem('workCount');
                return savedCount ? parseInt(savedCount, 10) : 0;
            });

            const [lastUpdated, setLastUpdated] = useState(() => {
                return localStorage.getItem('workLastUpdated') || '尚未開始';
            });

            const [wage, setWage] = useState(() => {
                const savedWage = localStorage.getItem('workWage');
                return savedWage ? parseInt(savedWage, 10) : 1000; 
            });

            const [isAnimating, setIsAnimating] = useState(false);
            const [showResetConfirm, setShowResetConfirm] = useState(false);
            const [showSettings, setShowSettings] = useState(false);

            // 儲存數據
            useEffect(() => {
                localStorage.setItem('workCount', count.toString());
                localStorage.setItem('workLastUpdated', lastUpdated);
                localStorage.setItem('workWage', wage.toString());
            }, [count, lastUpdated, wage]);

            // 格式化時間
            const getCurrentTime = () => {
                const now = new Date();
                return now.toLocaleString('zh-TW', {
                    month: 'numeric',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
            };

            const totalEarnings = count * wage;

            const handleIncrement = () => {
                setCount(prev => prev + 1);
                setLastUpdated(getCurrentTime());
                setIsAnimating(true);
                setTimeout(() => setIsAnimating(false), 150);
            };

            const handleDecrement = () => {
                if (count > 0) {
                    setCount(prev => prev - 1);
                }
            };

            const confirmReset = () => {
                setCount(0);
                setLastUpdated('已歸零');
                setShowResetConfirm(false);
            };

            return (
                <div className="min-h-[100dvh] flex flex-col items-center justify-between py-8 px-4 font-sans select-none relative overflow-hidden">
                
                {/* 頂部功能列 */}
                <div className="w-full max-w-md flex justify-between items-center mb-4">
                    <button 
                    onClick={() => setShowSettings(true)}
                    className="p-2 rounded-full bg-white shadow-sm border border-slate-200 text-slate-500 hover:text-blue-600 hover:border-blue-200 transition-colors"
                    >
                    <Settings size={20} />
                    </button>

                    <div className="flex items-center text-xs text-slate-400 gap-1 bg-slate-100/50 py-1 px-3 rounded-full">
                    <History size={12} />
                    <span>{lastUpdated}</span>
                    </div>
                    
                    <div className="w-9"></div>
                </div>

                {/* 核心顯示區 */}
                <div className="flex flex-col items-center justify-center w-full max-w-md space-y-8 flex-grow">
                    
                    <h1 className="text-xl font-bold text-slate-400 tracking-wider uppercase">Work Tracker</h1>

                    <div className="flex flex-col items-center space-y-2">
                    <div className="text-8xl font-bold tabular-nums tracking-tighter text-slate-800 leading-none">
                        {count}
                    </div>
                    <div className="text-slate-400 text-sm font-medium">累計次數</div>
                    
                    <div className="mt-4 py-2 px-6 bg-green-50 rounded-2xl border border-green-100 flex items-center gap-2 shadow-sm">
                        <DollarSign size={20} className="text-green-600" />
                        <span className="text-2xl font-bold text-green-700 tabular-nums">
                        ${totalEarnings.toLocaleString()}
                        </span>
                    </div>
                    </div>

                    <button
                    onClick={handleIncrement}
                    className={`
                        relative group w-40 h-40 rounded-full 
                        bg-gradient-to-b from-blue-500 to-blue-600 
                        shadow-[0_10px_30px_-10px_rgba(37,99,235,0.5)]
                        border-[6px] border-white ring-1 ring-slate-200
                        flex items-center justify-center
                        transition-all duration-100 ease-in-out
                        active:scale-95 active:shadow-none active:translate-y-1
                        ${isAnimating ? 'scale-95' : 'scale-100'}
                    `}
                    >
                    <div className="absolute inset-0 rounded-full bg-white opacity-0 group-hover:opacity-10 transition-opacity" />
                    <Plus size={56} className="text-white drop-shadow-md" strokeWidth={3} />
                    </button>

                </div>

                {/* 底部控制區 */}
                <div className="w-full max-w-xs grid grid-cols-2 gap-4 mt-8">
                    <button
                    onClick={handleDecrement}
                    disabled={count === 0}
                    className="flex items-center justify-center gap-2 py-4 rounded-xl bg-white border border-slate-200 shadow-sm hover:bg-slate-50 active:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed text-slate-600 transition-all"
                    >
                    <RotateCcw size={18} />
                    <span>復原</span>
                    </button>

                    <button
                    onClick={() => setShowResetConfirm(true)}
                    className="flex items-center justify-center gap-2 py-4 rounded-xl bg-white border border-slate-200 shadow-sm hover:bg-red-50 hover:border-red-100 hover:text-red-500 active:bg-red-100 text-slate-600 transition-all"
                    >
                    <Trash2 size={18} />
                    <span>歸零</span>
                    </button>
                </div>

                {/* 設定視窗 (Modal) */}
                {showSettings && (
                    <div className="fixed inset-0 z-50 flex items-center justify-center px-4">
                    <div 
                        className="absolute inset-0 bg-slate-900/20 backdrop-blur-sm transition-opacity"
                        onClick={() => setShowSettings(false)}
                    />
                    <div className="bg-white border border-slate-100 rounded-2xl p-6 w-full max-w-sm relative z-10 shadow-2xl animate-in fade-in zoom-in duration-200">
                        <div className="flex justify-between items-center mb-6">
                        <h3 className="text-lg font-bold text-slate-800">設定薪資</h3>
                        <button onClick={() => setShowSettings(false)} className="text-slate-400 hover:text-slate-600">
                            <X size={24} />
                        </button>
                        </div>
                        
                        <div className="space-y-4">
                        <div>
                            <label className="block text-sm font-medium text-slate-500 mb-2">
                            每按一次 +1 代表多少錢？
                            </label>
                            <div className="relative">
                            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <DollarSign size={18} className="text-slate-400" />
                            </div>
                            <input
                                type="number"
                                value={wage}
                                onChange={(e) => setWage(Number(e.target.value))}
                                className="block w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg font-semibold text-slate-800"
                                placeholder="例如: 1500"
                            />
                            </div>
                            <p className="text-xs text-slate-400 mt-2">
                            設定為 0 則不計算金額。
                            </p>
                        </div>

                        <button
                            onClick={() => setShowSettings(false)}
                            className="w-full py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors shadow-lg shadow-blue-600/20"
                        >
                            完成
                        </button>
                        </div>
                    </div>
                    </div>
                )}

                {/* 歸零確認視窗 (Modal) */}
                {showResetConfirm && (
                    <div className="fixed inset-0 z-50 flex items-center justify-center px-4">
                    <div 
                        className="absolute inset-0 bg-slate-900/20 backdrop-blur-sm"
                        onClick={() => setShowResetConfirm(false)}
                    />
                    <div className="bg-white border border-slate-100 rounded-2xl p-6 w-full max-w-sm relative z-10 shadow-2xl">
                        <div className="flex flex-col items-center text-center space-y-4">
                        <div className="w-12 h-12 rounded-full bg-red-50 flex items-center justify-center text-red-500">
                            <AlertTriangle size={28} />
                        </div>
                        <div>
                            <h3 className="text-xl font-bold text-slate-800">確定要歸零嗎？</h3>
                            <p className="text-slate-500 mt-1 text-sm">
                            目前的計數 ({count}) 與累積金額 (${totalEarnings.toLocaleString()}) 都會消失。
                            </p>
                        </div>
                        <div className="grid grid-cols-2 gap-3 w-full mt-2">
                            <button
                            onClick={() => setShowResetConfirm(false)}
                            className="py-3 px-4 rounded-xl bg-slate-100 text-slate-700 font-medium hover:bg-slate-200"
                            >
                            取消
                            </button>
                            <button
                            onClick={confirmReset}
                            className="py-3 px-4 rounded-xl bg-red-500 text-white font-medium hover:bg-red-600 shadow-lg shadow-red-500/20"
                            >
                            確認歸零
                            </button>
                        </div>
                        </div>
                    </div>
                    </div>
                )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
